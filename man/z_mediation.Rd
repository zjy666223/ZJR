% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/z_mediation.R
\name{z_mediation}
\alias{z_mediation}
\title{z_mediation: Cox 中介分析（连续 + 可选分位分类），返回可发表表格}
\usage{
z_mediation(
  data,
  exposure,
  mediator,
  time_col,
  event_col,
  covars = NULL,
  mreg = c("linear", "logistic"),
  a0 = NULL,
  a1 = NULL,
  a_pct = c(0.25, 0.75),
  m_cde = NULL,
  c_cond = NULL,
  interaction = TRUE,
  show_hr = FALSE,
  digits = 2,
  include_quantiles = FALSE,
  q = 4
)
}
\arguments{
\item{data}{\code{data.frame} 或 \code{data.table}。分析数据。}

\item{exposure}{字符串，暴露列（连续数值）。}

\item{mediator}{字符串，中介列。\code{mreg="linear"} 时为连续，\code{mreg="logistic"} 时为二元（0/1）。}

\item{time_col}{字符串，随访时间列。}

\item{event_col}{字符串，事件状态列（1=事件，0=删失）。}

\item{covars}{字符向量，协变量。需为数值或二分类；字符/因子会自动转为 0/1（后者按字母序较大者为 1）。}

\item{mreg}{\code{c("linear","logistic")}，中介回归类型（对应 \code{regmedint::mreg}）。}

\item{a0, a1}{数值，可选；连续暴露对比的两个取值。默认用 \code{a_pct} 的分位数。}

\item{a_pct}{数值向量，默认 \code{c(0.25,0.75)}；当 \code{a0/a1} 缺省时，取该分位数作为对比。}

\item{m_cde}{数值，受控直接效应时中介的固定取值；默认取中位数。}

\item{c_cond}{命名向量/列表，协变量评估水平（与 \code{covars} 对齐）；未提供时数值取中位数，二元取 1。}

\item{interaction}{逻辑值，是否包含 A×M 交互（传给 \code{regmedint}）。}

\item{show_hr}{逻辑值，是否把 \code{est_ci} 显示为 HR(95\%CI)（默认 FALSE，显示 log-HR）。}

\item{digits}{整数，小数位数（默认 2）。}

\item{include_quantiles}{逻辑值，是否追加按分位分类（Q1 参照）的结果。}

\item{q}{整数，分位数个数（默认 4）。若分位点重复会自动降级（并在 \code{diag$quantile_used} 记录）。}
}
\value{
一个列表：
\itemize{
\item \code{table}：数据框，列为 \verb{exposure, est_ci, p, med_prop, med_p}。
\item \code{gt}：若安装 \code{gt}，返回美化后的 gt 表（可 \code{gt::gtsave()} 导出）。
\item \code{fit_cont}：\code{regmedint} 连续暴露模型对象。
\item \code{diag}：诊断信息（样本量、使用的分位、a0/a1、m_cde、c_cond、分组事件数等）。
\item \code{cat_models}：分位分类各组 \code{mediation::mediate} 对象（若 \code{include_quantiles=TRUE}）。
}
}
\description{
面向生存结局（Cox）的轻量中介分析封装。
\itemize{
\item 连续暴露：基于 \strong{regmedint::regmedint(yreg="survCox")} 估计总效应 (TE) 与中介比例 (PM)，并给出 P 值。
\item 分位分类：可选把暴露按分位数切组（Q1 为参照），给出 Cox 的效应与 \code{mediation::mediate()} 的间接效应比例。
}

统一输出为数据框列：\verb{exposure, est_ci, p, med_prop, med_p}
（随后用于排版的列名在返回的 \code{gt} 对象中再映射为论文风格）。
}
\details{
\itemize{
\item 所有 \code{rbind} 前统一使用安全列名以避免 \code{match.names(...)} 异常。
\item 分位切组时若断点重复导致组数不足，会自动降级直至 ≥2 组；仍不足则跳过分类分析。
\item \code{mediation::mediate()} 失败会返回 NA，并在 \code{diag$mediate_errors_cat} 记录错误。
\item \code{est_ci} 的展示由 \code{show_hr} 控制：\code{FALSE} 为 log-HR(95\%CI)，\code{TRUE} 为 HR(95\%CI)。
}
}
\section{依赖}{

必需：\pkg{survival}、\pkg{regmedint}；若使用分位分类需要 \pkg{mediation}；若希望返回排版表需要 \pkg{gt}。
}

\examples{
\dontrun{
# 连续暴露 + 中介（最小示例）
res <- z_mediation(
  data      = d,
  exposure  = "twa_benzene",
  mediator  = "PhenoAge",
  time_col  = "AR_time",
  event_col = "AR_status",
  covars    = c("gender"),
  mreg      = "linear",
  include_quantiles = TRUE,  # 同时输出 Q1~Q4
  q = 4,
  show_hr   = FALSE          # TRUE 显示 HR(95\%CI)
)
res$table        # 主表
res$gt           # gt 表（可 gtsave 导出）
res$diag         # 诊断信息
}

}
