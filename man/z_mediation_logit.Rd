% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/z_mediation_new.R
\name{z_mediation_logit}
\alias{z_mediation_logit}
\title{一键中介分析（Imai 方法；logit/probit/linear；bootstrap 或 quasi-Bayes）}
\usage{
z_mediation_logit(
  data,
  exposure,
  mediator,
  outcome,
  covariates = NULL,
  outcome_family = c("logit", "probit", "linear"),
  mediator_family = c("linear", "probit", "logit"),
  treat.value = NULL,
  control.value = NULL,
  q = c(0.25, 0.75),
  sims = 2000,
  boot = TRUE,
  interaction = FALSE,
  covariate_profile = NULL,
  ref_levels = NULL,
  digits = 3,
  p_small_cutoff = 1e-04,
  export_csv = NULL
)
}
\arguments{
\item{data}{data.frame}

\item{exposure}{暴露变量名（字符）}

\item{mediator}{中介变量名（字符）}

\item{outcome}{结局变量名（字符）}

\item{covariates}{协变量名字符向量（数值0/1或因子均可）}

\item{outcome_family}{结局模型：\code{"logit"}（默认）、\code{"probit"}、\code{"linear"}}

\item{mediator_family}{中介模型：\code{"linear"}（默认）、\code{"probit"}、\code{"logit"}}

\item{treat.value}{处理组暴露值（给定则覆盖分位数对比）}

\item{control.value}{对照组暴露值（给定则覆盖分位数对比）}

\item{q}{暴露分位数对比，默认 \code{c(0.25, 0.75)}}

\item{sims}{仿真/自助次数（建议 1000–5000；冒烟可更小）}

\item{boot}{\code{TRUE}=bootstrap，\code{FALSE}=quasi-Bayesian}

\item{interaction}{是否在结局模型加入 \code{exposure:mediator} 交互（\strong{无需}向 \code{mediate()} 传 INT）}

\item{covariate_profile}{计算时固定的协变量画像（如 \code{list(age=50, ethnicity="White")}），不影响“是否调整”}

\item{ref_levels}{为因子协变量指定参考水平（如 \code{list(ethnicity="White")}；对 0/1 数值无效）}

\item{digits}{小数位；默认 3}

\item{p_small_cutoff}{极小 p 值显示阈值；默认 \code{1e-4}}

\item{export_csv}{可选 CSV 路径}
}
\value{
\code{list(table = tibble, med = mediate_object)}
}
\description{
传入数据与关键变量，自动构建中介与结局模型并调用 \code{mediation::mediate}，
输出四行表：Total effect、Mediation effect (ACME, average)、
Direct effect (ADE, average)、Proportion mediated (average) ，附 95\%CI 和 p 值。
连续暴露默认使用 \strong{p75 vs p25} 对比（可自定义）。
}
\details{
\itemize{
\item “调整协变量”通过把协变量同时放入中介与结局模型公式实现。
\item \code{ref_levels} 仅对因子协变量生效；若你的协变量已是 0/1 数值，\code{ref_levels} 可留空。
\item 若需要交互效应，设 \code{interaction=TRUE} 即会在结局公式中添加 \code{exposure:mediator} 项。
}
}
\examples{
\dontrun{
library(ZJR)
# 假设数据 d 包含列：twa_benzene, HD, AR_status, ethnicity, gender, age, smoking_status

# 1) 基础：logit 结局 + 线性中介，p75 vs p25，对 ethnicity 调整并设参考组
res1 <- ZJR::z_mediation_logit(
  data = d,
  exposure = "twa_benzene",
  mediator = "HD",
  outcome = "AR_status",
  covariates = c("ethnicity"),
  outcome_family = "logit",
  mediator_family = "linear",
  sims = 2000, boot = TRUE,
  ref_levels = list(ethnicity = "White")
)
res1$table

# 2) 多协变量（混合数值与因子）：0/1 数值协变量无需 ref_levels
res2 <- ZJR::z_mediation_logit(
  data = d,
  exposure = "twa_benzene", mediator = "HD", outcome = "AR_status",
  covariates = c("ethnicity","gender","age","smoking_status"),
  outcome_family = "logit", mediator_family = "linear",
  sims = 2000, boot = TRUE,
  ref_levels = list(ethnicity="White", smoking_status="Never")
)
res2$table

# 3) 自定义对比（p90 vs p10）
a0 <- as.numeric(quantile(d$twa_benzene, 0.10, na.rm = TRUE))
a1 <- as.numeric(quantile(d$twa_benzene, 0.90, na.rm = TRUE))
res3 <- ZJR::z_mediation_logit(
  data = d, exposure = "twa_benzene", mediator = "HD", outcome = "AR_status",
  covariates = c("ethnicity"),
  outcome_family = "logit", mediator_family = "linear",
  treat.value = a1, control.value = a0,
  sims = 2000, boot = TRUE,
  ref_levels = list(ethnicity = "White")
)
res3$table

# 4) 含 A×M 交互（自动加入 exposure:mediator）
res4 <- ZJR::z_mediation_logit(
  data = d, exposure = "twa_benzene", mediator = "HD", outcome = "AR_status",
  covariates = c("ethnicity"),
  outcome_family = "logit", mediator_family = "linear",
  interaction = TRUE,
  sims = 2000, boot = TRUE,
  ref_levels = list(ethnicity = "White")
)
res4$table

# 5) 指定“固定画像”计算
res5 <- ZJR::z_mediation_logit(
  data = d, exposure = "twa_benzene", mediator = "HD", outcome = "AR_status",
  covariates = c("ethnicity","age"),
  outcome_family = "logit", mediator_family = "linear",
  sims = 2000, boot = TRUE,
  covariate_profile = list(ethnicity="White", age=50),
  ref_levels = list(ethnicity = "White")
)
res5$table

# 6) 线性结局示例（outcome 为连续）
res6 <- ZJR::z_mediation_logit(
  data = d, exposure = "twa_benzene", mediator = "HD", outcome = "AR_status",
  covariates = c("ethnicity"),
  outcome_family = "linear", mediator_family = "linear",
  sims = 2000, boot = TRUE,
  ref_levels = list(ethnicity = "White")
)
res6$table

# 可选：导出 CSV
# ZJR::z_mediation_logit(..., export_csv = "mediation_table.csv")
}

}
