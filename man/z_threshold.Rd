% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/z_threshold.R
\name{z_threshold}
\alias{z_threshold}
\title{z_threshold: Two-piecewise (threshold) Cox regression summary table (robust)}
\usage{
z_threshold(
  data,
  time_col,
  status_col,
  expose_col,
  covariates = NULL,
  psi_init = c("median", "quantile25", "quantile75", "value"),
  psi_value = NULL,
  conf_level = 0.95,
  ties = "efron",
  grid_points = 50
)
}
\arguments{
\item{data}{data.frame/data.table containing analysis variables.}

\item{time_col, status_col}{Character. Follow-up time and event (0/1).}

\item{expose_col}{Character. Exposure column to search the inflection point.}

\item{covariates}{Character vector of covariate names (default \code{NULL}).}

\item{psi_init}{One of \code{"median"}, \code{"quantile25"}, \code{"quantile75"},
or \code{"value"} (then use \code{psi_value}) as initial value for \code{segmented()}.}

\item{psi_value}{Numeric; only used when \code{psi_init="value"}.}

\item{conf_level}{Confidence level for CIs (default 0.95).}

\item{ties}{Ties handling for \code{survival::coxph} (default \code{"efron"}).}

\item{grid_points}{Integer. Number of candidates in fallback grid search (default 50).}
}
\value{
A data.frame with rows:
\itemize{
\item Model 1 Fitting model by standard Cox regression (HR(95\%CI) P)
\item Model 2 Fitting model by two-piecewise Cox regression (blank)
\item Inflection point (estimated psi)
\item < psi : slope HR(95\%CI)
\item â‰¥ psi : slope HR(95\%CI)
\item P for likelihood ratio test
}
Attributes: \code{psi}, \code{fit_lin}, \code{fit_pw}.
}
\description{
Fit a standard Cox model and a two-piecewise Cox model with a single
inflection point on the exposure. The breakpoint is first searched by
\code{segmented::segmented()}; if that fails, a profile-likelihood grid
search is used as a fallback. Returns a publication-ready table.
}
\examples{
\dontrun{
res <- z_threshold(
  data = dt,
  time_col = "AR_time",
  status_col = "AR_status",
  expose_col = "twa_benzene",
  covariates = c("age","gender","ethnicity"),
  psi_init = "median"
)
print(res); attr(res, "psi")
utils::write.csv(res, "ar.csv",
row.names = FALSE, fileEncoding = "GB18030", na = "")
}
}
