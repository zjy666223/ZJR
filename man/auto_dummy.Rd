% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/auto_dummy.R
\name{auto_dummy}
\alias{auto_dummy}
\title{One-click dummy encoding for categorical variables}
\usage{
auto_dummy(
  df,
  cols = NULL,
  exclude = NULL,
  drop_first = TRUE,
  include_na = FALSE,
  keep_original = FALSE,
  max_levels = NULL,
  top_n_levels = NULL,
  on_high_cardinality = c("warn-skip", "skip", "error"),
  sep = "_",
  drop_level_name = "(ref)",
  sparse = FALSE,
  treat_logical_as_factor = TRUE
)
}
\arguments{
\item{df}{data.frame/tibble。}

\item{cols}{字符向量：需要编码的列名；默认 NULL 表示自动检测分类变量（factor/character/logical）。}

\item{exclude}{字符向量：需要从编码列表中排除的列名，默认 NULL。}

\item{drop_first}{逻辑值：是否丢弃每个变量的首个水平以避免完全共线性，默认 TRUE。}

\item{include_na}{逻辑值：是否为缺失值生成单独的 NA 指示列，默认 FALSE。}

\item{keep_original}{逻辑值：是否保留原始分类列，默认 FALSE（用哑变量替换）。}

\item{max_levels}{整数或 NULL：若分类水平数大于该值则报错或跳过（见 \code{on_high_cardinality}）。默认 NULL（不限制）。}

\item{top_n_levels}{整数或 NULL：仅对前 \code{top_n_levels} 个频数最高的水平生成列，其余合并为 \code{other}（若 \code{drop_first=TRUE} 会考虑 \code{other} 在内）。默认 NULL（不裁剪）。}

\item{on_high_cardinality}{字符串：对于超过 \code{max_levels} 的列如何处理，取值 \code{"error"}、\code{"skip"}、\code{"warn-skip"}。默认 \code{"warn-skip"}。}

\item{sep}{分隔符，用于生成列名，默认 "_"。}

\item{drop_level_name}{自定义被丢弃的参考水平名称标注，仅体现在返回的 \code{attr(out, "dummy_info")} 元信息中，默认 "(ref)"。}

\item{sparse}{逻辑值：是否以稀疏列形式返回（需要 \code{Matrix} 包；返回 data.frame 中含 \code{dgCMatrix} 列），默认 FALSE。}

\item{treat_logical_as_factor}{逻辑值：是否将逻辑列当作两水平分类处理，默认 TRUE。}
}
\value{
一个 data.frame，与输入同类；并附加属性 \code{dummy_info}（list），包含每个变量的水平、参考水平、生成列名等信息。
}
\description{
对数据框中的分类变量进行一键哑变量编码（0/1）。支持：
\itemize{
\item 选择/排除列；
\item 控制是否丢弃首个水平（防止完全共线性）；
\item 可为 NA 生成单独的指示列；
\item 控制是否保留原始列；
\item 限制高基数变量（按最大水平数或仅取 Top-N 水平）；
\item 可选输出稀疏矩阵列（需要 \code{Matrix} 包）。
}
}
\examples{
set.seed(1)
df <- data.frame(
  id = 1:6,
  sex = sample(c("M","F"), 6, TRUE),
  smoke = factor(sample(c("Never","Former","Current"), 6, TRUE),
                 levels = c("Never","Former","Current")),
  grp = sample(LETTERS[1:5], 6, TRUE),
  y = rnorm(6),
  stringsAsFactors = FALSE
)
# 基本用法：为自动识别的分类变量生成哑变量，保留参考水平
out <- auto_dummy(df, drop_first = TRUE, keep_original = FALSE)
attr(out, "dummy_info")

# 仅对指定列编码，并为 NA 生成指示列
df$grp[1] <- NA
out2 <- auto_dummy(df, cols = c("sex","grp"), include_na = TRUE, top_n_levels = 3)

# 高基数列：跳过并给出警告
out3 <- auto_dummy(df, max_levels = 4, on_high_cardinality = "warn-skip")
}
