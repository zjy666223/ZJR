% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/z_forestplot.R
\name{z_forestplot}
\alias{z_forestplot}
\title{Subgroup forest plot (publication-ready) with smart column mapping}
\usage{
# Minimal (auto-detect column names in CN/EN/aliases)
z_forestplot(data)

# Manually override or partially specify mapping (name or index)
z_forestplot(
  data,
  cols = list(subgroup = "分组", level = "水平", events = "事件数")
)
z_forestplot(
  data,
  cols = list(hrci = 5, events = 3)  # by column index
)

# Customize appearance; P值仅显示在组标题行；自动识别 HR/OR/RR 并设置 x 轴标签
z_forestplot(
  data,
  colors = list(box="#f0e68c", lines="#f79c42", summary="black", zero="gray60",
                background=c("transparent","#E6EEF7")),
  xticks = c(0.5,1,2,5,10),
  clip = c(0.4, 20),
  txt_gp = forestplot::fpTxtGp(
    ticks = grid::gpar(cex=0.7),
    label = grid::gpar(cex=0.9),
    xlab  = grid::gpar(cex=0.9)
  ),
  left_right_border = TRUE,
  verbose = TRUE
)

# Export high-res figures
z_forestplot_save("forest.pdf", data, width = 8, height = 6)
z_forestplot_save("forest.png", data, width = 8, height = 6, res = 300)
}
\arguments{
\item{data}{data.frame containing subgroup table.}

\item{cols}{\strong{Optional}. Named list mapping input columns. Any of the
following keys can be provided: \code{subgroup}, \code{level}, \code{events},
\code{total_py}, \code{hrci}, \code{phet}. Each value can be a column \strong{name}
(character) or \strong{index} (integer). Keys you omit will be auto-detected.
Examples:
\itemize{
\item \code{cols = list(subgroup="分组", level="水平", hrci="HR95CI")}
    \item \code{cols = list(hrci=5, events=3)}  (by column index)
}}

\item{headers}{character vector for table headers. Length 5 or 6 when P column exists.
Default: c("Subgroup","Level","Events","Total / Person-years",
"Adjusted HR (95\% CI)","P for heterogeneity").}

\item{colors}{named list passed to \code{forestplot::fpColors()}, e.g.
list(box="black", lines="black", summary="black", zero="gray60",
background=c("transparent","#E6EEF7")). Unsupported fields are ignored.}

\item{show_p_in_header}{logical; show P only on subgroup header rows (default TRUE).}

\item{left_right_border}{logical; draw vertical border lines at left/right (default FALSE).}

\item{border_col}{color of border lines (default "gray40").}

\item{xlab}{x-axis label (default "Adjusted HR (95\% CI)"). If set to NULL,
it will auto-switch to "Adjusted OR/RR (95\% CI)" according to detected measure.}

\item{draw}{logical; draw immediately (default TRUE).}

\item{verbose}{logical; print diagnostics and the resolved column mapping (default FALSE).}

\item{...}{additional args forwarded to \code{forestplot::forestplot()}
(xticks, clip, graph.pos, boxsize, lwd.ci, txt_gp, hrzl_lines, graphwidth, etc.).}
}
\value{
An object returned by \code{forestplot::forestplot()} (invisible).
}
\description{
Create a forest plot for subgroup analysis from a tidy table.
Now supports \strong{automatic column detection} (CN/EN aliases, case/space tolerant),
manual/partial mapping, and column-index mapping. Robust parser for
\verb{HR (95\% CI)} also accepts \code{OR}/\code{RR} and mixed punctuation \verb{（ ）},
square brackets [ ], en-dash, \code{"to"}, etc.
If your \code{forestplot} version does not support \code{background} in \code{fpColors()},
the option is ignored gracefully.
}
\examples{
\dontrun{
# See Usage. You can keep your CSV headers in Chinese; no need to rename.
}

}
